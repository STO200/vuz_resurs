# Валидация и обновление ресурсов - HSE

## Семантическая валидация через Claude

Вместо локального `validate_resource()` с SequenceMatcher, Claude напрямую анализирует:

**Ключевой принцип:** Название + описание в карточке должны соответствовать фактическому содержанию по ссылке.

### MCP Инструменты

- `get_resource_by_id()` - получить данные ресурса
- `fetch_webpage()` - загрузить контент страницы
- `extract_key_info()` - извлечь даты, сущности, ключевые фразы
- `update_json_file()` - сохранить обновленные данные
- `save_validation_report()` - создать отчет валидации

### Статусы валидации

- **OK**: Название и описание полностью соответствуют контенту страницы → нет изменений
- **NEEDS_UPDATE**: Частичное соответствие (тема совпадает, детали отличаются) → **автоматически корректируем**
- **MISMATCH**: Название/описание не соответствует контенту → **автоматически переписываем**

### Автоматическое обновление

Когда статус NEEDS_UPDATE или MISMATCH:

1. Claude анализирует фактический контент страницы
2. Генерирует корректное описание (100-150 символов)
3. Обновляет JSON файл через `update_json_file()`
4. Фиксирует изменение в отчете: `was_auto_corrected: true`

### Отчеты

Каждый JSON файл получает отдельный отчет валидации в формате:
- `hse_{имя_файла}_validation.json`

Схема отчета включает:
```json
{
  "resource_id": "...",
  "validation_status": "OK|NEEDS_UPDATE|MISMATCH",
  "confidence": 0.85,
  "current_description": "...",
  "suggested_description": "...",
  "was_auto_corrected": true/false,
  "semantic_analysis": {
    "name_match": true/false,
    "description_match": "full|partial|none",
    "url_relevance": "specific|aggregation|unrelated",
    "key_discrepancies": [...]
  }
}
```

## Обработанные файлы HSE

✅ **Валидация всех 8 файлов завершена:**

1. `universities/hse/infoEvents.json` - 7 ресурсов, 4 обновлено
2. `universities/hse/olympiads.json` - 6 ресурсов, 1 обновлено
3. `universities/hse/courses.json` - 6 ресурсов, 3 обновлено
4. `universities/hse/educationalEvents.json` - 6 ресурсов, 4 обновлено
5. `universities/hse/practicalEvents.json` - 6 ресурсов, 3 обновлено
6. `universities/hse/summerPrograms.json` - 4 ресурса, 0 обновлено
7. `universities/hse/schools.json` - 4 ресурса, 1 обновлено
8. `universities/hse/onlineResources.json` - 9 ресурсов, 7 обновлено

### Общая статистика

- **Всего ресурсов:** 48
- **OK (без изменений):** 25
- **NEEDS_UPDATE (автокорректировано):** 14
- **MISMATCH (переписано):** 9
- **Всего обновлено:** 23 ресурса

## Запуск валидации для всех HSE файлов

```bash
python3 scripts/validate_all_hse_files.py
```

Скрипт:

1. Обрабатывает все 8 JSON файлов HSE параллельно
2. Для каждого ресурса загружает контент по ссылке
3. Анализирует соответствие названия + описания
4. При необходимости обновляет описание в JSON
5. Сохраняет обновленные файлы
6. Создает отчеты валидации для каждого файла
